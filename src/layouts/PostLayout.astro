---
import BaseLayout from './BaseLayout.astro';
import { formatDate, getReadingTime, getCategoryColor, getCategoryLabel } from '../utils/seo';
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'posts'>;
  content: string;
}

const { post, content } = Astro.props;
const { title, description, date, updated, category, tags, image, imageAlt } = post.data;
const readingTime = getReadingTime(content);
---

<BaseLayout
  title={`${title} | 0xmiles`}
  description={description}
  image={image}
  type="article"
  publishedTime={date}
  tags={tags}
>
  <article class="container-custom py-12">
    <div class="max-w-4xl mx-auto">
      <!-- Article Header -->
      <header class="mb-8">
        <!-- Category Badge -->
        <div class="mb-4">
          <a 
            href={`/category/${category}`}
            class={`inline-block px-3 py-1 text-sm font-medium rounded-full ${getCategoryColor(category)} no-underline`}
          >
            {getCategoryLabel(category)}
          </a>
        </div>

        <!-- Title -->
        <h1 class="text-4xl md:text-5xl font-bold mb-4 text-gray-900 dark:text-white">
          {title}
        </h1>

        <!-- Description -->
        <p class="text-xl text-gray-600 dark:text-gray-400 mb-6">
          {description}
        </p>

        <!-- Meta Information -->
        <div class="flex flex-wrap items-center gap-4 text-sm text-gray-600 dark:text-gray-400">
          <time datetime={date.toISOString()}>
            {formatDate(date)}
          </time>
          {updated && (
            <>
              <span>•</span>
              <span>Updated: {formatDate(updated)}</span>
            </>
          )}
          <span>•</span>
          <span>{readingTime}</span>
        </div>

        <!-- Featured Image -->
        {image && (
          <div class="mt-8">
            <img 
              src={image} 
              alt={imageAlt || title}
              class="w-full h-auto rounded-lg shadow-lg"
            />
          </div>
        )}
      </header>

      <!-- Article Content -->
      <div class="article-content prose-custom">
        <slot />
      </div>

      <!-- Tags -->
      {tags.length > 0 && (
        <footer class="mt-12 pt-8 border-t border-green-200 dark:border-gray-700">
          <div class="flex flex-wrap gap-2">
            {tags.map((tag) => (
              <span class="px-3 py-1 text-sm bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 rounded-full">
                #{tag}
              </span>
            ))}
          </div>
        </footer>
      )}

      <!-- Back to Posts Link -->
      <div class="mt-8">
        <a 
          href="/posts" 
          class="inline-flex items-center text-green-500 dark:text-green-300 hover:text-green-700 dark:hover:text-green-200 font-medium"
        >
          ← Back to all posts
        </a>
      </div>
    </div>
  </article>
</BaseLayout>

