---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { formatDate } from '../utils/seo';

// Get all published posts
const allPosts = await getCollection('posts', ({ data }) => !data.draft);

// Sort by date (newest first)
const sortedPosts = allPosts.sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

// Get recent posts (top 3)
const recentPosts = sortedPosts.slice(0, 3);
---

<BaseLayout 
  title="그리고 또 뭐였더라?"
  description="배우고 느낀 모든 일을 기록하고 기억하기 위한 블로그입니다."
>
  <!-- Hero Section with Dev Icon -->
  <section class="container-custom py-16 md:py-24">
    <div class="flex flex-col md:flex-row items-start gap-8 md:gap-12">
      <!-- Dev Icon -->
      <div class="flex-shrink-0">
        <div class="w-32 h-32 md:w-40 md:h-40 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center">
          <span class="text-4xl md:text-5xl font-light text-gray-400 dark:text-gray-500">Dev</span>
        </div>
      </div>

      <!-- Introduction Text -->
      <div class="flex-1">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-6">
          안녕하세요, 박용준입니다
        </h1>
        <p class="text-lg md:text-xl text-gray-600 dark:text-gray-400 leading-relaxed mb-6">
          세상은 항상 새롭고, 도전적인 문제를 던집니다.
          <br/>
          현상을 이해하고, 본질을 찾아내는 능력을 기르기 위한 과정을 기록합니다.
        </p>
        <div class="flex items-center gap-4 text-gray-500 dark:text-gray-500">
          <a 
            href="https://github.com/0xmiles" 
            target="_blank" 
            rel="noopener noreferrer"
            class="hover:text-gray-900 dark:hover:text-white transition-colors no-underline"
          >
            GitHub
          </a>
          <span>·</span>
          <a 
            href="mailto:9898junjun2@gmail.com"
            class="hover:text-gray-900 dark:hover:text-white transition-colors no-underline"
          >
            이메일
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Recent Posts Section -->
  <section class="container-custom py-16">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-8">
      최근 글
    </h2>

    <div class="space-y-12">
      {recentPosts.map(post => (
        <article class="group">
          <a href={`/posts/${post.slug}`} class="block no-underline">
            <div class="flex items-baseline gap-4 mb-2">
              <time class="text-sm text-gray-500 dark:text-gray-500 min-w-[100px]">
                {formatDate(post.data.date)}
              </time>
              <span class="text-sm text-gray-400 dark:text-gray-600">·</span>
              <span class="text-sm text-gray-500 dark:text-gray-500">
                {Math.ceil(post.body.split(/\s+/).length / 200)}분
              </span>
            </div>
            <h3 class="text-xl md:text-2xl font-bold text-gray-900 dark:text-white group-hover:text-green-600 dark:group-hover:text-green-400 transition-colors mb-3">
              {post.data.title}
            </h3>
            <p class="text-gray-600 dark:text-gray-400 leading-relaxed line-clamp-2">
              {post.data.description}
            </p>
            {post.data.tags && post.data.tags.length > 0 && (
              <div class="flex flex-wrap gap-2 mt-4">
                {post.data.tags.slice(0, 3).map(tag => (
                  <span class="text-xs px-2 py-1 rounded bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400">
                    {tag}
                  </span>
                ))}
              </div>
            )}
          </a>
        </article>
      ))}
    </div>
  </section>
</BaseLayout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

